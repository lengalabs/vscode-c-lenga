import{u as A,b as s,j as e,E as x,v as F,L as G,S as Q,c as X}from"../shared/vscode.js";function Z(){const{mode:r,setMode:i}=A(),[d,o]=s.useState(!1),a=()=>{i(r===x.View?x.Edit:x.View)},n=f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),a())},u="mode-indicator-keybind",w=r===x.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:a,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),onKeyDown:n,role:"button","aria-describedby":d?u:void 0,style:{padding:"5px 10px",backgroundColor:r===x.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:r===x.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(r===x.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:d?`0 0 0 2px ${r===x.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:d?"translateY(-1px)":void 0,filter:d?"brightness(1.05)":void 0},children:["MODE: ",r.toUpperCase()]}),d&&e.jsx("div",{id:u,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:w})]})}const ee={"←":"left","→":"right","↑":"up","↓":"down"},te=({direction:r})=>{const i={right:0,down:90,left:180,up:-90}[r];return e.jsxs("svg",{role:"img","aria-hidden":"true",focusable:"false",width:"14",height:"14",viewBox:"0 0 24 24",style:{transform:`rotate(${i}deg)`,transformOrigin:"50% 50%"},children:[e.jsx("path",{d:"M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),e.jsx("path",{d:"M13 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})},N=r=>{const i=ee[r];return i?e.jsx(te,{direction:i}):null};function re(){const{mode:r,keyboardState:i}=A(),{pressedKeys:d,modifiers:o}=i,{shift:a,alt:n,ctrl:u}=o,[w,f]=s.useState(n),[b,K]=s.useState(!0),[j,M]=s.useState(!1),E=[{vimLabel:"J",arrowLabel:"←",equivalents:["arrowleft"],columns:{base:"Previous Field",shift:null,ctrl:"To Parent",ctrlShift:null,alt:"To Parent's Prev Sibling",altShift:"To Parent's Next Sibling",altCtrl:null}},{vimLabel:"K",arrowLabel:"↓",equivalents:["arrowdown"],columns:{base:"Next Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Down",altCtrl:null,altShift:"Into Next Sibling"}},{vimLabel:"L",arrowLabel:"↑",equivalents:["arrowup"],columns:{base:"Previous Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Up",altCtrl:null,altShift:"Into Prev Sibling"}},{vimLabel:"Ñ",arrowLabel:"→",equivalents:["arrowright","n"],columns:{base:"Next Field",shift:null,ctrl:"To First Child",ctrlShift:"To Last Child",alt:"Into Next Sibling",altCtrl:null,altShift:"Into Prev Sibling"}},{vimLabel:"↵",arrowLabel:"↵",equivalents:[],columns:{base:"Insert Sibling After",shift:"Insert Sibling Before",ctrl:"Insert Child at Start",ctrlShift:"Insert Child at End",alt:null,altCtrl:null,altShift:null}},{vimLabel:"⌫",arrowLabel:"⌫",equivalents:["delete","backspace"],columns:{base:"Delete Node",shift:null,ctrl:null,ctrlShift:null,alt:null,altCtrl:null,altShift:null}}],[S,g]=s.useState("navigate"),p=[{key:"navigate",label:"Navigate"},{key:"move",label:"Move (Alt)"}],l={navigate:[{key:"base",label:"Base"},{key:"ctrl",label:"Ctrl"}],move:[{key:"alt",label:"Alt"},{key:"altCtrl",label:"Alt + Ctrl"}]};s.useEffect(()=>{if(n===w)return;f(n);const t=n?"move":"navigate";S!==t&&g(t)},[n,S,w,f]);const k=t=>{g(t)},B=l[S],$={base:"shift",ctrl:"ctrlShift",alt:"altShift"},P=t=>({border:t?"1px solid rgba(255, 140, 50, 0.4)":"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t?"var(--vscode-button-background)":"var(--vscode-input-background)",color:t?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"0.9rem",lineHeight:"1",transition:"all 0.03s ease",cursor:"default",transform:t?"translateY(0.15rem) scale(0.98)":"translateY(0)",boxShadow:t?"0 0.05rem 0.2rem rgba(255, 140, 50, 0.15), inset 0 0.15rem 0.25rem rgba(0, 0, 0, 0.2)":"0 0.2rem 0.4rem rgba(0, 0, 0, 0.1), inset 0 0.1rem 0 rgba(255, 255, 255, 0.15), inset 0 -0.1rem 0.15rem rgba(0, 0, 0, 0.1)"}),T=(t,c=[],m="2.8rem",v="2.8rem")=>{const L=[t.vim,...c].map(y=>y.toLowerCase()).some(y=>d.has(y)),I=t.arrow||t.vim,h=b?t.vim:N(t.arrow)??I;return e.jsx("div",{style:{width:m,height:v,...P(L)},children:e.jsx("div",{style:{fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.15rem"},children:h})},`${t.vim}-${t.arrow}`)},D=(t,c,m="3.2rem")=>e.jsx("div",{style:{width:m,height:"2rem",...P(c)},children:t},t);if(r!=="view")return null;const C=n&&a&&!u?"altShift":n&&!a&&!u?"alt":u&&a&&!n?"ctrlShift":u&&!a&&!n?"ctrl":a&&!n&&!u?"shift":!n&&!a&&!u?"base":null,z=C?C==="shift"?"base":C==="ctrlShift"?"ctrl":C==="altShift"?"alt":C:null,Y=t=>{const c=[t.vimLabel,t.arrowLabel].filter(Boolean).map(v=>v.toLowerCase());return[...new Set([...c,...(t.equivalents||[]).map(v=>v.toLowerCase())])].some(v=>d.has(v))},q=`2rem repeat(${B.length}, 1fr)`;return e.jsxs("div",{style:{position:"fixed",bottom:"0.5rem",right:"0.5rem",zIndex:999,display:"flex",gap:"0.5rem",alignItems:"flex-end",flexDirection:"column"},children:[e.jsx("button",{type:"button",onClick:()=>M(t=>!t),"aria-controls":"keyboard-visualization-table","aria-expanded":!j,style:{border:"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",padding:"0.25rem 0.6rem",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",cursor:"pointer",transition:"all 0.1s ease",fontSize:"0.75rem",fontFamily:"monospace",alignSelf:"flex-end"},children:j?"Show keybinds":"Hide keybinds"}),e.jsxs("div",{id:"keyboard-visualization-table",hidden:j,style:{padding:"0.6rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)",fontSize:"0.75rem",fontFamily:"monospace",minWidth:"30rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{display:"flex",gap:"0.4rem"},children:p.map(t=>{const c=S===t.key;return e.jsx("button",{type:"button",onClick:()=>k(t.key),style:{border:"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",padding:"0.25rem 0.6rem",backgroundColor:c?"var(--vscode-button-background)":"var(--vscode-editorWidget-background)",color:c?"var(--vscode-button-foreground)":"var(--vscode-editorWidget-foreground)",cursor:"pointer",transition:"all 0.1s ease",fontSize:"0.75rem",fontFamily:"monospace"},children:t.label},t.key)})}),e.jsxs("button",{type:"button",onClick:()=>K(t=>!t),"aria-pressed":b,style:{border:"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",padding:"0.25rem 0.6rem",backgroundColor:b?"var(--vscode-button-background)":"var(--vscode-editorWidget-background)",color:b?"var(--vscode-button-foreground)":"var(--vscode-editorWidget-foreground)",cursor:"pointer",transition:"all 0.1s ease",fontSize:"0.75rem",fontFamily:"monospace",whiteSpace:"nowrap"},children:["vim mode: ",b?"On":"Off"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:q,gap:"0.5rem",paddingBottom:"0.2rem",borderBottom:"1px solid var(--vscode-editorWidget-border)",marginBottom:"0.2rem"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:.8},children:"Key"}),B.map(t=>{const c=z===t.key;return e.jsx("div",{style:{fontWeight:"bold",opacity:c?1:.5,color:c?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:t.label},t.key)})]}),E.map((t,c)=>{const m=Y(t),v=t.arrowLabel||t.vimLabel,V=b?t.vimLabel:N(t.arrowLabel)??v;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:q,gap:"0.5rem",padding:"0.55rem 0.5rem 0.55rem 0.4rem",margin:"0 -0.4rem",borderBottom:c<E.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none",backgroundColor:m?"rgba(255, 140, 50, 0.1)":"transparent",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:m?1:.9,color:m?"rgba(255, 140, 50, 1)":"var(--vscode-editorWidget-foreground)",transition:"all 0.03s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.2rem",textAlign:"center"},children:V}),B.map(L=>{const I=$[L.key],h=I?C===I:!1,y=z===L.key,H=t.columns[L.key]||"—",W=I?t.columns[I]:null,J=m&&(y||h)&&(H!=="—"||W),R=!!W,U={position:"absolute",top:"0.1rem",right:"0.3rem",fontSize:"0.68rem",opacity:W?.8:0,color:h?"var(--vscode-textLink-foreground)":y?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",transform:R&&h?"scale(1.12)":"scale(1)",transformOrigin:"top right",transition:"color 0.15s ease, transform 0.15s ease, opacity 0.15s ease"},_={fontSize:"0.85rem",lineHeight:1.3,paddingTop:W?"1rem":"0.5rem",paddingBottom:W?"0":"0.5rem",color:R&&h?"var(--vscode-descriptionForeground)":void 0,transform:R&&h?"scale(0.96)":"scale(1)",transformOrigin:"left bottom",transition:"color 0.15s ease, transform 0.15s ease, opacity 0.15s ease",opacity:R&&h?.7:1};return e.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",opacity:y?.9:.4,color:y?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:J?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0rem 0.5rem 0rem 0.4rem",margin:"-0.35rem -0.4rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:U,children:W||" "}),e.jsx("div",{style:_,children:H})]},L.key)})]},c)})]}),e.jsxs("div",{hidden:j,style:{padding:"0.8rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",fontSize:"1rem",fontFamily:"monospace",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem"},children:[T({vim:"J",arrow:"←"},["arrowleft"]),T({vim:"K",arrow:"↓"},["arrowdown"]),T({vim:"L",arrow:"↑"},["arrowup"]),T({vim:"Ñ",arrow:"→"},["arrowright","n"])]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",justifyContent:"space-between"},children:[D("CTRL",u),D("ALT",n),D("SHIFT",a,"3.6rem")]})]})]})}const O=s.createContext(null);function oe(){const r=s.useContext(O);if(!r)throw new Error("DebugContext must be used inside a provider");return r}function ne(){var n;const{debug:r}=oe(),{selectedNodeId:i,selectedKey:d,parentNodeInfo:o,nodeMap:a}=A();return e.jsx(e.Fragment,{children:r&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",i]}),e.jsxs("p",{children:["selectedNodeType: ",(n=a.get(i??""))==null?void 0:n.type]}),e.jsxs("p",{children:["selectedKey: ",d]}),e.jsxs("p",{children:["parentNodeId: ",o==null?void 0:o.parent.id]}),e.jsxs("p",{children:["parentType: ",o==null?void 0:o.parent.type]}),e.jsxs("p",{children:["parentKey: ",o==null?void 0:o.key]}),e.jsxs("p",{children:["parentIndex: ",o==null?void 0:o.index]})]})})}function se({debug:r,children:i}){return e.jsx(O.Provider,{value:{debug:r},children:i})}const ie="dark";function ae({sourceFile:r,firstElementCreatorRef:i}){const{requestFocus:d}=A(),o=s.useRef(!1);return s.useEffect(()=>{var a;if(!o.current)if(r.code.length===0)console.log("Requesting initial focus on empty file creator"),(a=i.current)==null||a.focus(),o.current=!0;else{const n=r.code[0];console.log("Requesting initial focus on first node:",n.id),d({nodeId:n.id}),o.current=!0}},[r,d,i]),null}function le(r){return r==="light"?"light":"dark"}function de(){const[r,i]=s.useState(void 0),[d,o]=s.useState(null),[a,n]=s.useState(null),[u,w]=s.useState(null),[f,b]=s.useState(null),[K,j]=s.useState(!1);s.useEffect(()=>{const g=p=>{console.log("event:",p);const l=p.data;console.log("message:",l),l.type==="update"?i(l.contents):l.type==="availableInserts"?b(l.contents):l.type==="toggleDebug"?(console.log("Toggling debug mode"),j(k=>!k)):l.type==="theme"&&(document.documentElement.dataset.theme=le(l.contents))};return window.addEventListener("message",g),document.documentElement.dataset.theme=ie,F.postMessage({type:"ready"}),()=>{window.removeEventListener("message",g)}},[]),s.useEffect(()=>{console.log("SelectedKey updated:",a)},[a]);const M=(g,p)=>{const l={type:"nodeEdit",contents:g,key:p};i(k=>k&&{...k}),console.log("sending message: ",l),F.postMessage(l)},E=(g,p)=>{const l={type:"requestAvailableInserts",nodeId:g,nodeKey:p};console.log("requesting available inserts: ",l),F.postMessage(l)},S=s.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(se,{debug:K,children:r?e.jsxs(G,{sourceFile:r,onEdit:M,onRequestAvailableInserts:E,availableInserts:f,selectedNodeId:d,selectedKey:a,parentNodeInfo:u,setSelectedNodeId:o,setSelectedKey:g=>{console.log("setSelectedKey called with key:",g),n(g)},setParentNodeInfo:w,children:[e.jsx(ae,{sourceFile:r,firstElementCreatorRef:S}),e.jsx(Z,{}),e.jsx(re,{}),e.jsx(Q,{node:r,firstElementCreatorRef:S}),e.jsx(ne,{})]}):e.jsx("p",{children:"loading..."})})})}X.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(de,{})}));
