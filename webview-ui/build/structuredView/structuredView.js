import{u as R,b as i,j as e,E as x,v as P,L as H,S as $,c as O}from"../shared/vscode.js";function Y(){const{mode:r,setMode:d}=R(),[l,o]=i.useState(!1),n=()=>{d(r===x.View?x.Edit:x.View)},s=b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),n())},u="mode-indicator-keybind",S=r===x.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:n,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),onKeyDown:s,role:"button","aria-describedby":l?u:void 0,style:{padding:"5px 10px",backgroundColor:r===x.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:r===x.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(r===x.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:l?`0 0 0 2px ${r===x.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:l?"translateY(-1px)":void 0,filter:l?"brightness(1.05)":void 0},children:["MODE: ",r.toUpperCase()]}),l&&e.jsx("div",{id:u,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:S})]})}function J(){const{mode:r,keyboardState:d}=R(),{pressedKeys:l,modifiers:o}=d,{shift:n,alt:s,ctrl:u}=o,[S,b]=i.useState(s),[f,N]=i.useState(!0),I=[{vimLabel:"J",arrowLabel:"←",equivalents:["arrowleft"],columns:{base:"Previous Field",shift:null,ctrl:"Navigate to Parent",ctrlShift:null,alt:"Move Node to Parent's Prev Sibling",altShift:"Move Node to Parent's Next Sibling"}},{vimLabel:"K",arrowLabel:"↓",equivalents:["arrowdown"],columns:{base:"Next Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Move Node Down",altShift:"Move Node Into Next Sibling"}},{vimLabel:"L",arrowLabel:"↑",equivalents:["arrowup"],columns:{base:"Previous Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Move Node Up",altShift:"Move Node Into Prev Sibling"}},{vimLabel:"Ñ",arrowLabel:"→",equivalents:["arrowright","n"],columns:{base:"Next Field",shift:null,ctrl:"Navigate to First Child",ctrlShift:"Navigate to Last Child",alt:"Move Node Into Next Sibling",altShift:"Move Node Into Prev Sibling"}},{vimLabel:"↵",arrowLabel:"↵",equivalents:[],columns:{base:"Insert Sibling After",shift:"Insert Sibling Before",ctrl:"Insert Child at Start",ctrlShift:"Insert Child at End",alt:null,altShift:null}},{vimLabel:"⌫",arrowLabel:"⌫",equivalents:["delete","backspace"],columns:{base:"Delete Node",shift:null,ctrl:null,ctrlShift:null,alt:null,altShift:null}}],[w,M]=i.useState("navigate"),W=[{key:"navigate",label:"Navigate"},{key:"move",label:"Move (Alt)"}],g={navigate:[{key:"base",label:"Base"},{key:"ctrl",label:"Ctrl"}],move:[{key:"alt",label:"Alt"}]};i.useEffect(()=>{if(s===S)return;b(s);const t=s?"move":"navigate";w!==t&&M(t)},[s,w,S,b]);const p=t=>{M(t)},a=g[w],y={base:"shift",ctrl:"ctrlShift",alt:"altShift"},T=t=>({border:t?"1px solid rgba(255, 140, 50, 0.4)":"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t?"var(--vscode-button-background)":"var(--vscode-input-background)",color:t?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"0.9rem",lineHeight:"1",transition:"all 0.03s ease",cursor:"default",transform:t?"translateY(0.15rem) scale(0.98)":"translateY(0)",boxShadow:t?"0 0.05rem 0.2rem rgba(255, 140, 50, 0.15), inset 0 0.15rem 0.25rem rgba(0, 0, 0, 0.2)":"0 0.2rem 0.4rem rgba(0, 0, 0, 0.1), inset 0 0.1rem 0 rgba(255, 255, 255, 0.15), inset 0 -0.1rem 0.15rem rgba(0, 0, 0, 0.1)"}),E=(t,c=[],v="2.8rem",m="2.8rem")=>{const j=[t.vim,...c].map(h=>h.toLowerCase()).some(h=>l.has(h)),K=f?t.vim:t.arrow;return e.jsx("div",{style:{width:v,height:m,...T(j)},children:e.jsx("div",{style:{fontWeight:"bold"},children:K})},`${t.vim}-${t.arrow}`)},A=(t,c,v="3.2rem")=>e.jsx("div",{style:{width:v,height:"2rem",...T(c)},children:t},t);if(r!=="view")return null;const k=s&&n&&!u?"altShift":s&&!n&&!u?"alt":u&&n&&!s?"ctrlShift":u&&!n&&!s?"ctrl":n&&!s&&!u?"shift":!s&&!n&&!u?"base":null,B=k?k==="shift"?"base":k==="ctrlShift"?"ctrl":k==="altShift"?"alt":k:null,z=t=>{const c=[t.vimLabel,t.arrowLabel].filter(Boolean).map(m=>m.toLowerCase());return[...new Set([...c,...(t.equivalents||[]).map(m=>m.toLowerCase())])].some(m=>l.has(m))},D=`3.8rem repeat(${a.length}, 1fr)`;return e.jsxs("div",{style:{position:"fixed",bottom:"1rem",left:"1rem",zIndex:999,display:"flex",gap:"1rem",alignItems:"flex-end"},children:[e.jsxs("div",{style:{padding:"0.8rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",fontSize:"1rem",fontFamily:"monospace",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem"},children:[E({vim:"J",arrow:"←"},["arrowleft"]),E({vim:"K",arrow:"↓"},["arrowdown"]),E({vim:"L",arrow:"↑"},["arrowup"]),E({vim:"Ñ",arrow:"→"},["arrowright","n"])]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",justifyContent:"space-between"},children:[A("CTRL",u),A("ALT",s),A("SHIFT",n,"3.6rem")]})]}),e.jsxs("div",{style:{padding:"0.6rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)",fontSize:"0.75rem",fontFamily:"monospace"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{display:"flex",gap:"0.4rem"},children:W.map(t=>{const c=w===t.key;return e.jsx("button",{type:"button",onClick:()=>p(t.key),style:{border:"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",padding:"0.25rem 0.6rem",backgroundColor:c?"var(--vscode-button-background)":"var(--vscode-editorWidget-background)",color:c?"var(--vscode-button-foreground)":"var(--vscode-editorWidget-foreground)",cursor:"pointer",transition:"all 0.1s ease",fontSize:"0.75rem",fontFamily:"monospace"},children:t.label},t.key)})}),e.jsxs("button",{type:"button",onClick:()=>N(t=>!t),"aria-pressed":f,style:{border:"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",padding:"0.25rem 0.6rem",backgroundColor:f?"var(--vscode-button-background)":"var(--vscode-editorWidget-background)",color:f?"var(--vscode-button-foreground)":"var(--vscode-editorWidget-foreground)",cursor:"pointer",transition:"all 0.1s ease",fontSize:"0.75rem",fontFamily:"monospace",whiteSpace:"nowrap"},children:["vim mode: ",f?"On":"Off"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:D,gap:"0.5rem",paddingBottom:"0.4rem",borderBottom:"1px solid var(--vscode-editorWidget-border)",marginBottom:"0.4rem"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:.8},children:"Key"}),a.map(t=>{const c=B===t.key;return e.jsx("div",{style:{fontWeight:"bold",opacity:c?1:.5,color:c?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:t.label},t.key)})]}),I.map((t,c)=>{const v=z(t),m=(f?t.vimLabel:t.arrowLabel)||t.vimLabel;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:D,gap:"0.5rem",padding:"0.55rem 0.5rem 0.55rem 0.4rem",margin:"0 -0.4rem",borderBottom:c<I.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none",backgroundColor:v?"rgba(255, 140, 50, 0.1)":"transparent",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:v?1:.9,color:v?"rgba(255, 140, 50, 1)":"var(--vscode-editorWidget-foreground)",transition:"all 0.03s ease"},children:m}),a.map(C=>{const j=y[C.key],K=j?k===j:!1,h=B===C.key,q=t.columns[C.key]||"—",L=j?t.columns[j]:null,V=v&&(h||K)&&(q!=="—"||L);return e.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",opacity:h?.9:.4,color:h?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:V?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0.55rem 0.5rem 0.45rem 0.4rem",margin:"-0.35rem -0.4rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:{position:"absolute",top:"0.2rem",right:"0.3rem",fontSize:"0.68rem",opacity:L?.75:0,color:K?"var(--vscode-textLink-foreground)":h?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",transition:"all 0.03s ease"},children:L||" "}),e.jsx("div",{style:{fontSize:"0.85rem",lineHeight:1.3,paddingTop:L?"0.6rem":"0.3rem",paddingBottom:L?"0":"0.3rem"},children:q})]},C.key)})]},c)})]})]})}const F=i.createContext(null);function U(){const r=i.useContext(F);if(!r)throw new Error("DebugContext must be used inside a provider");return r}function G(){var s;const{debug:r}=U(),{selectedNodeId:d,selectedKey:l,parentNodeInfo:o,nodeMap:n}=R();return e.jsx(e.Fragment,{children:r&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",d]}),e.jsxs("p",{children:["selectedNodeType: ",(s=n.get(d??""))==null?void 0:s.type]}),e.jsxs("p",{children:["selectedKey: ",l]}),e.jsxs("p",{children:["parentNodeId: ",o==null?void 0:o.parent.id]}),e.jsxs("p",{children:["parentType: ",o==null?void 0:o.parent.type]}),e.jsxs("p",{children:["parentKey: ",o==null?void 0:o.key]}),e.jsxs("p",{children:["parentIndex: ",o==null?void 0:o.index]})]})})}function Q({debug:r,children:d}){return e.jsx(F.Provider,{value:{debug:r},children:d})}function X({sourceFile:r,firstElementCreatorRef:d}){const{requestFocus:l}=R(),o=i.useRef(!1);return i.useEffect(()=>{var n;if(!o.current)if(r.code.length===0)console.log("Requesting initial focus on empty file creator"),(n=d.current)==null||n.focus(),o.current=!0;else{const s=r.code[0];console.log("Requesting initial focus on first node:",s.id),l({nodeId:s.id}),o.current=!0}},[r,l,d]),null}function Z(){const[r,d]=i.useState(void 0),[l,o]=i.useState(null),[n,s]=i.useState(null),[u,S]=i.useState(null),[b,f]=i.useState(null),[N,I]=i.useState(!1);i.useEffect(()=>{const g=p=>{console.log("event:",p);const a=p.data;console.log("message:",a),a.type==="update"?d(a.contents):a.type==="availableInserts"?f(a.contents):a.type==="toggleDebug"&&(console.log("Toggling debug mode"),I(y=>!y))};return window.addEventListener("message",g),P.postMessage({type:"ready"}),()=>{window.removeEventListener("message",g)}},[]),i.useEffect(()=>{console.log("SelectedKey updated:",n)},[n]);const w=(g,p)=>{const a={type:"nodeEdit",contents:g,key:p};d(y=>y&&{...y}),console.log("sending message: ",a),P.postMessage(a)},M=(g,p)=>{const a={type:"requestAvailableInserts",nodeId:g,nodeKey:p};console.log("requesting available inserts: ",a),P.postMessage(a)},W=i.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(Q,{debug:N,children:r?e.jsxs(H,{sourceFile:r,onEdit:w,onRequestAvailableInserts:M,availableInserts:b,selectedNodeId:l,selectedKey:n,parentNodeInfo:u,setSelectedNodeId:o,setSelectedKey:g=>{console.log("setSelectedKey called with key:",g),s(g)},setParentNodeInfo:S,children:[e.jsx(X,{sourceFile:r,firstElementCreatorRef:W}),e.jsx(Y,{}),e.jsx(J,{}),e.jsx($,{node:r,firstElementCreatorRef:W}),e.jsx(G,{})]}):e.jsx("p",{children:"loading..."})})})}O.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Z,{})}));
