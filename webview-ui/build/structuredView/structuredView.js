import{u as S,b as a,j as e,E as b,v as k,L as C,S as I,c as M}from"../shared/vscode.js";function W(){const{mode:r,setMode:l}=S(),[d,t]=a.useState(!1),c=()=>{l(r===b.View?b.Edit:b.View)},u=x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),c())},f="mode-indicator-keybind",p=r===b.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:c,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),onFocus:()=>t(!0),onBlur:()=>t(!1),onKeyDown:u,role:"button","aria-describedby":d?f:void 0,style:{padding:"5px 10px",backgroundColor:r===b.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:r===b.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(r===b.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:d?`0 0 0 2px ${r===b.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:d?"translateY(-1px)":void 0,filter:d?"brightness(1.05)":void 0},children:["MODE: ",r.toUpperCase()]}),d&&e.jsx("div",{id:f,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:p})]})}function E(){const{mode:r,keyboardState:l}=S(),{pressedKeys:d,modifiers:t}=l,c=[{key:"J/←",base:"Move to Parent",shift:null,alt:"Move to Parent's Prev Sibling",altShift:"Move to Parent's Next Sibling"},{key:"L/↑",base:"Move to Prev Sibling",shift:"Previous Field",alt:"Move Node Up",altShift:"Move Into Prev Sibling"},{key:"K/↓",base:"Move to Next Sibling",shift:"Next Field",alt:"Move Node Down",altShift:"Move Into Next Sibling"},{key:"Ñ/→",base:"Move to First Child",shift:"Move to Last Child",alt:"Move Into Next Sibling",altShift:"Move Into Prev Sibling"},{key:"I",base:"Next Field",shift:null,alt:null,altShift:null},{key:"O",base:"Previous Field",shift:null,alt:null,altShift:null},{key:"Enter",base:"Insert Sibling After",shift:"Insert Sibling Before",alt:null,altShift:null},{key:"Del",base:"Delete Node",shift:null,alt:null,altShift:null}],u=o=>({border:o?"1px solid rgba(255, 140, 50, 0.4)":"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:o?"var(--vscode-button-background)":"var(--vscode-input-background)",color:o?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"0.9rem",lineHeight:"1",transition:"all 0.03s ease",cursor:"default",transform:o?"translateY(0.15rem) scale(0.98)":"translateY(0)",boxShadow:o?"0 0.05rem 0.2rem rgba(255, 140, 50, 0.15), inset 0 0.15rem 0.25rem rgba(0, 0, 0, 0.2)":"0 0.2rem 0.4rem rgba(0, 0, 0, 0.1), inset 0 0.1rem 0 rgba(255, 255, 255, 0.15), inset 0 -0.1rem 0.15rem rgba(0, 0, 0, 0.1)"}),f=(o,g,n,y="2.8rem",v="2.8rem")=>{const i=[o,...n||[]].map(m=>m.toLowerCase()).some(m=>d.has(m));return e.jsxs("div",{style:{width:y,height:v,...u(i)},children:[e.jsx("div",{style:{fontSize:"0.6rem",opacity:.7},children:g}),e.jsx("div",{style:{fontWeight:"bold"},children:o.toUpperCase()})]},o)},p=(o,g,n="3.2rem")=>e.jsx("div",{style:{width:n,height:"2rem",...u(g)},children:o},o);if(r!=="view")return null;const s=(()=>{const{shift:o,alt:g}=t;return g&&o?"altShift":g?"alt":o?"shift":"base"})(),j=o=>o.toLowerCase().split("/").map(n=>n==="←"?"arrowleft":n==="↑"?"arrowup":n==="↓"?"arrowdown":n==="→"?"arrowright":n==="del"?"delete":n).some(n=>d.has(n));return e.jsxs("div",{style:{position:"fixed",bottom:"1rem",left:"1rem",zIndex:999,display:"flex",gap:"1rem",alignItems:"flex-end"},children:[e.jsxs("div",{style:{padding:"0.8rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",fontSize:"1rem",fontFamily:"monospace",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem",justifyContent:"center"},children:[f("i","↓",[],"2.4rem","2.4rem"),f("o","↑",[],"2.4rem","2.4rem")]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem"},children:[f("j","←",["arrowleft"]),f("k","↓",["arrowdown"]),f("l","↑",["arrowup"]),f("ñ","→",["arrowright","n"])]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",justifyContent:"space-between"},children:[p("CTRL",t.ctrl),p("ALT",t.alt),p("SHIFT",t.shift,"3.6rem")]})]}),e.jsxs("div",{style:{padding:"0.6rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)",fontSize:"0.75rem",fontFamily:"monospace"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"3.5rem 1fr 1fr 1fr",gap:"0.5rem",paddingBottom:"0.4rem",borderBottom:"1px solid var(--vscode-editorWidget-border)",marginBottom:"0.4rem"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:.8},children:"Key"}),e.jsx("div",{style:{fontWeight:"bold",opacity:s==="base"?1:.5,color:s==="base"?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:"Base"}),e.jsx("div",{style:{fontWeight:"bold",opacity:s==="shift"?1:.5,color:s==="shift"?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:"Shift"}),e.jsxs("div",{style:{fontWeight:"bold",opacity:s==="alt"||s==="altShift"?1:.5,color:s==="alt"||s==="altShift"?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:["Alt",s==="altShift"&&"+Shift"]})]}),c.map((o,g)=>{const n=j(o.key);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"3.5rem 1fr 1fr 1fr",gap:"0.5rem",padding:"0.3rem",margin:"0 -0.3rem",paddingLeft:"0.3rem",paddingRight:"0.3rem",borderBottom:g<c.length-1?"1px solid var(--vscode-editorWidget-border)":"none",backgroundColor:n?"rgba(255, 140, 50, 0.1)":"transparent",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:n?1:.9,color:n?"rgba(255, 140, 50, 1)":"var(--vscode-editorWidget-foreground)",transition:"all 0.03s ease"},children:o.key}),e.jsx("div",{style:{opacity:s==="base"?.9:.4,color:s==="base"?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:n&&s==="base"?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0.2rem 0.3rem",margin:"-0.2rem -0.3rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:o.base||"—"}),e.jsx("div",{style:{opacity:s==="shift"?.9:.4,color:s==="shift"?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:n&&s==="shift"?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0.2rem 0.3rem",margin:"-0.2rem -0.3rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:o.shift||"—"}),e.jsx("div",{style:{opacity:s==="alt"||s==="altShift"?.9:.4,color:s==="alt"||s==="altShift"?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:n&&(s==="alt"||s==="altShift")?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0.2rem 0.3rem",margin:"-0.2rem -0.3rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:(s==="altShift"?o.altShift:o.alt)||"—"})]},g)})]})]})}const w=a.createContext(null);function R(){const r=a.useContext(w);if(!r)throw new Error("DebugContext must be used inside a provider");return r}function K(){var u;const{debug:r}=R(),{selectedNodeId:l,selectedKey:d,parentNodeInfo:t,nodeMap:c}=S();return e.jsx(e.Fragment,{children:r&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",l]}),e.jsxs("p",{children:["selectedNodeType: ",(u=c.get(l??""))==null?void 0:u.type]}),e.jsxs("p",{children:["selectedKey: ",d]}),e.jsxs("p",{children:["parentNodeId: ",t==null?void 0:t.parent.id]}),e.jsxs("p",{children:["parentType: ",t==null?void 0:t.parent.type]}),e.jsxs("p",{children:["parentKey: ",t==null?void 0:t.key]}),e.jsxs("p",{children:["parentIndex: ",t==null?void 0:t.index]})]})})}function P({debug:r,children:l}){return e.jsx(w.Provider,{value:{debug:r},children:l})}const D="dark";function L({sourceFile:r,firstElementCreatorRef:l}){const{requestFocus:d}=S(),t=a.useRef(!1);return a.useEffect(()=>{var c;if(!t.current)if(r.code.length===0)console.log("Requesting initial focus on empty file creator"),(c=l.current)==null||c.focus(),t.current=!0;else{const u=r.code[0];console.log("Requesting initial focus on first node:",u.id),d({nodeId:u.id}),t.current=!0}},[r,d,l]),null}function F(r){return r==="light"?"light":"dark"}function B(){const[r,l]=a.useState(void 0),[d,t]=a.useState(null),[c,u]=a.useState(null),[f,p]=a.useState(null),[x,s]=a.useState(null),[j,o]=a.useState(!1);a.useEffect(()=>{const v=h=>{console.log("event:",h);const i=h.data;console.log("message:",i),i.type==="update"?l(i.contents):i.type==="availableInserts"?s(i.contents):i.type==="toggleDebug"?(console.log("Toggling debug mode"),o(m=>!m)):i.type==="theme"&&(document.documentElement.dataset.theme=F(i.contents))};return window.addEventListener("message",v),document.documentElement.dataset.theme=D,k.postMessage({type:"ready"}),()=>{window.removeEventListener("message",v)}},[]),a.useEffect(()=>{console.log("SelectedKey updated:",c)},[c]);const g=(v,h)=>{const i={type:"nodeEdit",contents:v,key:h};l(m=>m&&{...m}),console.log("sending message: ",i),k.postMessage(i)},n=(v,h)=>{const i={type:"requestAvailableInserts",nodeId:v,nodeKey:h};console.log("requesting available inserts: ",i),k.postMessage(i)},y=a.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(P,{debug:j,children:r?e.jsxs(C,{sourceFile:r,onEdit:g,onRequestAvailableInserts:n,availableInserts:x,selectedNodeId:d,selectedKey:c,parentNodeInfo:f,setSelectedNodeId:t,setSelectedKey:v=>{console.log("setSelectedKey called with key:",v),u(v)},setParentNodeInfo:p,children:[e.jsx(L,{sourceFile:r,firstElementCreatorRef:y}),e.jsx(W,{}),e.jsx(E,{}),e.jsx(I,{node:r,firstElementCreatorRef:y}),e.jsx(K,{})]}):e.jsx("p",{children:"loading..."})})})}M.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(B,{})}));
