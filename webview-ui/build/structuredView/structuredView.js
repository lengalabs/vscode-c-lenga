import{u as S,b as a,j as e,E as p,v as k,L as I,S as E,c as M}from"../shared/vscode.js";function K(){const{mode:s,setMode:c}=S(),[d,r]=a.useState(!1),u=()=>{c(s===p.View?p.Edit:p.View)},g=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),u())},v="mode-indicator-keybind",m=s===p.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:u,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),onFocus:()=>r(!0),onBlur:()=>r(!1),onKeyDown:g,role:"button","aria-describedby":d?v:void 0,style:{padding:"5px 10px",backgroundColor:s===p.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:s===p.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(s===p.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:d?`0 0 0 2px ${s===p.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:d?"translateY(-1px)":void 0,filter:d?"brightness(1.05)":void 0},children:["MODE: ",s.toUpperCase()]}),d&&e.jsx("div",{id:v,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:m})]})}function R(){const{mode:s,keyboardState:c}=S(),{pressedKeys:d,modifiers:r}=c,u=[{key:"J/←",equivalents:["arrowleft"],columns:{base:"Previous Field",shift:null,ctrl:"Navigate to Parent",ctrlShift:null,alt:"Move Node to Parent's Prev Sibling",altShift:"Move Node to Parent's Next Sibling"}},{key:"L/↑",equivalents:["arrowup"],columns:{base:"Previous Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Move Node Up",altShift:"Move Node Into Prev Sibling"}},{key:"K/↓",equivalents:["arrowdown"],columns:{base:"Next Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Move Node Down",altShift:"Move Node Into Next Sibling"}},{key:"Ñ/→",equivalents:["arrowright","n"],columns:{base:"Next Field",shift:null,ctrl:"Navigate to First Child",ctrlShift:"Navigate to Last Child",alt:"Move Node Into Next Sibling",altShift:"Move Node Into Prev Sibling"}},{key:"Enter",equivalents:[],columns:{base:"Insert Sibling After",shift:"Insert Sibling Before",ctrl:"Insert Child at Start",ctrlShift:"Insert Child at End",alt:null,altShift:null}},{key:"Del/Backspace",equivalents:["delete","backspace"],columns:{base:"Delete Node",shift:null,ctrl:null,ctrlShift:null,alt:null,altShift:null}}],g=t=>({border:t?"1px solid rgba(255, 140, 50, 0.4)":"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t?"var(--vscode-button-background)":"var(--vscode-input-background)",color:t?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"0.9rem",lineHeight:"1",transition:"all 0.03s ease",cursor:"default",transform:t?"translateY(0.15rem) scale(0.98)":"translateY(0)",boxShadow:t?"0 0.05rem 0.2rem rgba(255, 140, 50, 0.15), inset 0 0.15rem 0.25rem rgba(0, 0, 0, 0.2)":"0 0.2rem 0.4rem rgba(0, 0, 0, 0.1), inset 0 0.1rem 0 rgba(255, 255, 255, 0.15), inset 0 -0.1rem 0.15rem rgba(0, 0, 0, 0.1)"}),v=(t,n,i,o="2.8rem",f="2.8rem")=>{const b=[t,...i||[]].map(j=>j.toLowerCase()).some(j=>d.has(j));return e.jsxs("div",{style:{width:o,height:f,...g(b)},children:[e.jsx("div",{style:{fontSize:"0.6rem",opacity:.7},children:n}),e.jsx("div",{style:{fontWeight:"bold"},children:t.toUpperCase()})]},t)},m=(t,n,i="3.2rem")=>e.jsx("div",{style:{width:i,height:"2rem",...g(n)},children:t},t);if(s!=="view")return null;const x=(()=>{const{shift:t,alt:n,ctrl:i}=r;return n&&t&&!i?"altShift":n&&!t&&!i?"alt":i&&t&&!n?"ctrlShift":i&&!t&&!n?"ctrl":t&&!n&&!i?"shift":!n&&!t&&!i?"base":null})(),w=t=>{const n=t.key.toLowerCase().split("/").map(o=>o==="←"?"arrowleft":o==="↑"?"arrowup":o==="↓"?"arrowdown":o==="→"?"arrowright":o==="del"?"delete":o);return[...new Set([...n,...t.equivalents||[]].map(o=>o.toLowerCase()))].some(o=>d.has(o))},y=[{key:"base",label:"Base"},{key:"shift",label:"Shift"},{key:"ctrl",label:"Ctrl"},{key:"ctrlShift",label:"Ctrl+Shift"},{key:"alt",label:"Alt"},{key:"altShift",label:"Alt+Shift"}];return e.jsxs("div",{style:{position:"fixed",bottom:"1rem",left:"1rem",zIndex:999,display:"flex",gap:"1rem",alignItems:"flex-end"},children:[e.jsxs("div",{style:{padding:"0.8rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",fontSize:"1rem",fontFamily:"monospace",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem"},children:[v("j","←",["arrowleft"]),v("k","↓",["arrowdown"]),v("l","↑",["arrowup"]),v("ñ","→",["arrowright","n"])]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",justifyContent:"space-between"},children:[m("CTRL",r.ctrl),m("ALT",r.alt),m("SHIFT",r.shift,"3.6rem")]})]}),e.jsxs("div",{style:{padding:"0.6rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)",fontSize:"0.75rem",fontFamily:"monospace"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"3.8rem repeat(6, 1fr)",gap:"0.5rem",paddingBottom:"0.4rem",borderBottom:"1px solid var(--vscode-editorWidget-border)",marginBottom:"0.4rem"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:.8},children:"Key"}),y.map(t=>{const n=x===t.key;return e.jsx("div",{style:{fontWeight:"bold",opacity:n?1:.5,color:n?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:t.label},t.key)})]}),u.map((t,n)=>{const i=w(t);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"3.8rem repeat(6, 1fr)",gap:"0.5rem",padding:"0.3rem",margin:"0 -0.3rem",paddingLeft:"0.3rem",paddingRight:"0.3rem",borderBottom:n<u.length-1?"1px solid var(--vscode-editorWidget-border)":"none",backgroundColor:i?"rgba(255, 140, 50, 0.1)":"transparent",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:i?1:.9,color:i?"rgba(255, 140, 50, 1)":"var(--vscode-editorWidget-foreground)",transition:"all 0.03s ease"},children:t.key}),y.map(o=>{const f=x===o.key,l=t.columns[o.key]||"—",b=i&&f&&l!=="—";return e.jsx("div",{style:{opacity:f?.9:.4,color:f?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:b?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0.2rem 0.3rem",margin:"-0.2rem -0.3rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:l},o.key)})]},n)})]})]})}const C=a.createContext(null);function W(){const s=a.useContext(C);if(!s)throw new Error("DebugContext must be used inside a provider");return s}function N(){var g;const{debug:s}=W(),{selectedNodeId:c,selectedKey:d,parentNodeInfo:r,nodeMap:u}=S();return e.jsx(e.Fragment,{children:s&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",c]}),e.jsxs("p",{children:["selectedNodeType: ",(g=u.get(c??""))==null?void 0:g.type]}),e.jsxs("p",{children:["selectedKey: ",d]}),e.jsxs("p",{children:["parentNodeId: ",r==null?void 0:r.parent.id]}),e.jsxs("p",{children:["parentType: ",r==null?void 0:r.parent.type]}),e.jsxs("p",{children:["parentKey: ",r==null?void 0:r.key]}),e.jsxs("p",{children:["parentIndex: ",r==null?void 0:r.index]})]})})}function D({debug:s,children:c}){return e.jsx(C.Provider,{value:{debug:s},children:c})}function P({sourceFile:s,firstElementCreatorRef:c}){const{requestFocus:d}=S(),r=a.useRef(!1);return a.useEffect(()=>{var u;if(!r.current)if(s.code.length===0)console.log("Requesting initial focus on empty file creator"),(u=c.current)==null||u.focus(),r.current=!0;else{const g=s.code[0];console.log("Requesting initial focus on first node:",g.id),d({nodeId:g.id}),r.current=!0}},[s,d,c]),null}function L(){const[s,c]=a.useState(void 0),[d,r]=a.useState(null),[u,g]=a.useState(null),[v,m]=a.useState(null),[h,x]=a.useState(null),[w,y]=a.useState(!1);a.useEffect(()=>{const o=f=>{console.log("event:",f);const l=f.data;console.log("message:",l),l.type==="update"?c(l.contents):l.type==="availableInserts"?x(l.contents):l.type==="toggleDebug"&&(console.log("Toggling debug mode"),y(b=>!b))};return window.addEventListener("message",o),k.postMessage({type:"ready"}),()=>{window.removeEventListener("message",o)}},[]),a.useEffect(()=>{console.log("SelectedKey updated:",u)},[u]);const t=(o,f)=>{const l={type:"nodeEdit",contents:o,key:f};c(b=>b&&{...b}),console.log("sending message: ",l),k.postMessage(l)},n=(o,f)=>{const l={type:"requestAvailableInserts",nodeId:o,nodeKey:f};console.log("requesting available inserts: ",l),k.postMessage(l)},i=a.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(D,{debug:w,children:s?e.jsxs(I,{sourceFile:s,onEdit:t,onRequestAvailableInserts:n,availableInserts:h,selectedNodeId:d,selectedKey:u,parentNodeInfo:v,setSelectedNodeId:r,setSelectedKey:o=>{console.log("setSelectedKey called with key:",o),g(o)},setParentNodeInfo:m,children:[e.jsx(P,{sourceFile:s,firstElementCreatorRef:i}),e.jsx(K,{}),e.jsx(R,{}),e.jsx(E,{node:s,firstElementCreatorRef:i}),e.jsx(N,{})]}):e.jsx("p",{children:"loading..."})})})}M.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(L,{})}));
