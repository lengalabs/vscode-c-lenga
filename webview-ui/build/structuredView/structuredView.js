import{u as y,b as n,j as e,E as x,v as S,L as C,S as E,c as k}from"../shared/vscode.js";function R(){const{mode:o,setMode:d}=y(),[i,t]=n.useState(!1),r=()=>{d(o===x.View?x.Edit:x.View)},l=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r())},c="mode-indicator-keybind",g=o===x.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:r,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),onFocus:()=>t(!0),onBlur:()=>t(!1),onKeyDown:l,role:"button","aria-describedby":i?c:void 0,style:{padding:"5px 10px",backgroundColor:o===x.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:o===x.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(o===x.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:i?`0 0 0 2px ${o===x.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:i?"translateY(-1px)":void 0,filter:i?"brightness(1.05)":void 0},children:["MODE: ",o.toUpperCase()]}),i&&e.jsx("div",{id:c,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:g})]})}function M({position:o="top-left"}){const{mode:d,keyboardState:i}=y(),{pressedKeys:t,modifiers:r}=i,l=()=>{const s={position:"fixed",zIndex:999,padding:"8px",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"4px",fontSize:"10px",fontFamily:"monospace",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"};switch(o){case"top-left":return{...s,top:"10px",left:"10px"};case"top-right":return{...s,top:"10px",right:"10px"};case"bottom-left":return{...s,bottom:"10px",left:"10px"};case"bottom-right":return{...s,bottom:"10px",right:"10px"};default:return{...s,top:"10px",left:"10px"}}},c=(s,u,h,m="24px",j="24px")=>{const f=t.has(s.toLowerCase());return e.jsxs("div",{style:{width:m,height:j,border:f?"2px solid var(--vscode-focusBorder)":"1px solid var(--vscode-input-border)",borderRadius:"3px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:f?"var(--vscode-button-background)":"var(--vscode-input-background)",color:f?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"8px",lineHeight:"1",transition:"all 0.08s ease",cursor:"default",userSelect:"none",transform:f?"scale(1.1)":"scale(1)",boxShadow:f?"0 0 8px rgba(0, 122, 255, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)":"inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[e.jsx("div",{style:{fontSize:"6px",opacity:.7},children:u}),e.jsx("div",{style:{fontWeight:"bold"},children:s.toUpperCase()})]},s)},g=(s,u,h="32px")=>e.jsx("div",{style:{width:h,height:"20px",border:u?"2px solid var(--vscode-focusBorder)":"1px solid var(--vscode-input-border)",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:u?"var(--vscode-button-background)":"var(--vscode-input-background)",color:u?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"7px",fontWeight:"bold",transition:"all 0.08s ease",cursor:"default",userSelect:"none",transform:u?"scale(1.05)":"scale(1)",boxShadow:u?"0 0 6px rgba(0, 122, 255, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2)":"inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:s},s);return d!=="view"?null:e.jsxs("div",{style:l(),children:[e.jsxs("div",{style:{display:"flex",gap:"2px",marginBottom:"4px",justifyContent:"center"},children:[c("o","↑",void 0,"20px","20px"),c("i","↓",void 0,"20px","20px")]}),e.jsxs("div",{style:{display:"flex",gap:"2px",marginBottom:"4px"},children:[c("j","←"),c("l","↑"),c("k","↓"),c("n","→")]}),e.jsxs("div",{style:{display:"flex",gap:"2px",justifyContent:"space-between"},children:[g("CTRL",r.ctrl),g("ALT",r.alt),g("SHIFT",r.shift,"36px")]})]})}const I=n.createContext(null);function D(){const o=n.useContext(I);if(!o)throw new Error("DebugContext must be used inside a provider");return o}function K(){var l;const{debug:o}=D(),{selectedNodeId:d,selectedKey:i,parentNodeInfo:t,nodeMap:r}=y();return e.jsx(e.Fragment,{children:o&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",d]}),e.jsxs("p",{children:["selectedNodeType: ",(l=r.get(d??""))==null?void 0:l.type]}),e.jsxs("p",{children:["selectedKey: ",i]}),e.jsxs("p",{children:["parentNodeId: ",t==null?void 0:t.parent.id]}),e.jsxs("p",{children:["parentType: ",t==null?void 0:t.parent.type]}),e.jsxs("p",{children:["parentKey: ",t==null?void 0:t.key]}),e.jsxs("p",{children:["parentIndex: ",t==null?void 0:t.index]})]})})}function W({debug:o,children:d}){return e.jsx(I.Provider,{value:{debug:o},children:d})}function z({sourceFile:o,firstElementCreatorRef:d}){const{requestFocus:i}=y(),t=n.useRef(!1);return n.useEffect(()=>{var r;if(!t.current)if(o.code.length===0)console.log("Requesting initial focus on empty file creator"),(r=d.current)==null||r.focus(),t.current=!0;else{const l=o.code[0];console.log("Requesting initial focus on first node:",l.id),i({nodeId:l.id}),t.current=!0}},[o,i,d]),null}function L(){const[o,d]=n.useState(void 0),[i,t]=n.useState(null),[r,l]=n.useState(null),[c,g]=n.useState(null),[s,u]=n.useState(null),[h,m]=n.useState(!1);n.useEffect(()=>{const p=b=>{console.log("event:",b);const a=b.data;console.log("message:",a),a.type==="update"?d(a.contents):a.type==="availableInserts"?u(a.contents):a.type==="toggleDebug"&&(console.log("Toggling debug mode"),m(v=>!v))};return window.addEventListener("message",p),S.postMessage({type:"ready"}),()=>{window.removeEventListener("message",p)}},[]),n.useEffect(()=>{console.log("SelectedKey updated:",r)},[r]);const j=(p,b)=>{const a={type:"nodeEdit",contents:p,key:b};d(v=>v&&{...v}),console.log("sending message: ",a),S.postMessage(a)},f=(p,b)=>{const a={type:"requestAvailableInserts",nodeId:p,nodeKey:b};console.log("requesting available inserts: ",a),S.postMessage(a)},w=n.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(W,{debug:h,children:o?e.jsxs(C,{sourceFile:o,onEdit:j,onRequestAvailableInserts:f,availableInserts:s,selectedNodeId:i,selectedKey:r,parentNodeInfo:c,setSelectedNodeId:t,setSelectedKey:p=>{console.log("setSelectedKey called with key:",p),l(p)},setParentNodeInfo:g,children:[e.jsx(z,{sourceFile:o,firstElementCreatorRef:w}),e.jsx(R,{}),e.jsx(M,{position:"bottom-left"}),e.jsx(E,{node:o,firstElementCreatorRef:w}),e.jsx(K,{})]}):e.jsx("p",{children:"loading..."})})})}k.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(L,{})}));
