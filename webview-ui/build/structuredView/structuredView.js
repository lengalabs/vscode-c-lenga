import{u as h,b as n,j as e,E as m,v as S,L as E,S as I,c as k}from"../shared/vscode.js";function R(){const{mode:t,setMode:d}=h(),[i,o]=n.useState(!1),s=()=>{d(t===m.View?m.Edit:m.View)},l=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),s())},f="mode-indicator-keybind",u=t===m.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:s,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),onKeyDown:l,role:"button","aria-describedby":i?f:void 0,style:{padding:"5px 10px",backgroundColor:t===m.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:t===m.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(t===m.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:i?`0 0 0 2px ${t===m.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:i?"translateY(-1px)":void 0,filter:i?"brightness(1.05)":void 0},children:["MODE: ",t.toUpperCase()]}),i&&e.jsx("div",{id:f,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:u})]})}function K({position:t="top-left"}){const{mode:d,keyboardState:i}=h(),{pressedKeys:o,modifiers:s}=i,l=()=>{const r={position:"fixed",zIndex:999,padding:"0.8rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",fontSize:"1rem",fontFamily:"monospace",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)"};switch(t){case"top-left":return{...r,top:"1rem",left:"1rem"};case"top-right":return{...r,top:"1rem",right:"1rem"};case"bottom-left":return{...r,bottom:"1rem",left:"1rem"};case"bottom-right":return{...r,bottom:"1rem",right:"1rem"};default:return{...r,top:"1rem",left:"1rem"}}},f=r=>({border:r?"1px solid rgba(255, 140, 50, 0.4)":"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:r?"var(--vscode-button-background)":"var(--vscode-input-background)",color:r?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"0.9rem",lineHeight:"1",transition:"all 0.03s ease",cursor:"default",transform:r?"translateY(0.15rem) scale(0.98)":"translateY(0)",boxShadow:r?"0 0.05rem 0.2rem rgba(255, 140, 50, 0.15), inset 0 0.15rem 0.25rem rgba(0, 0, 0, 0.2)":"0 0.2rem 0.4rem rgba(0, 0, 0, 0.1), inset 0 0.1rem 0 rgba(255, 255, 255, 0.15), inset 0 -0.1rem 0.15rem rgba(0, 0, 0, 0.1)"}),u=(r,x,b,y="2.8rem",j="2.8rem")=>{const c=[r,...b||[]].map(g=>g.toLowerCase()).some(g=>o.has(g));return e.jsxs("div",{style:{width:y,height:j,...f(c)},children:[e.jsx("div",{style:{fontSize:"0.6rem",opacity:.7},children:x}),e.jsx("div",{style:{fontWeight:"bold"},children:r.toUpperCase()})]},r)},p=(r,x,b="3.2rem")=>e.jsx("div",{style:{width:b,height:"2rem",...f(x)},children:r},r);return d!=="view"?null:e.jsxs("div",{style:l(),children:[e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem",justifyContent:"center"},children:[u("i","↓",[],"2.4rem","2.4rem"),u("o","↑",[],"2.4rem","2.4rem")]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem"},children:[u("j","←",["arrowleft"]),u("k","↓",["arrowdown"]),u("l","↑",["arrowup"]),u("ñ","→",["arrowright","n"])]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",justifyContent:"space-between"},children:[p("CTRL",s.ctrl),p("ALT",s.alt),p("SHIFT",s.shift,"3.6rem")]})]})}const C=n.createContext(null);function M(){const t=n.useContext(C);if(!t)throw new Error("DebugContext must be used inside a provider");return t}function D(){var l;const{debug:t}=M(),{selectedNodeId:d,selectedKey:i,parentNodeInfo:o,nodeMap:s}=h();return e.jsx(e.Fragment,{children:t&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",d]}),e.jsxs("p",{children:["selectedNodeType: ",(l=s.get(d??""))==null?void 0:l.type]}),e.jsxs("p",{children:["selectedKey: ",i]}),e.jsxs("p",{children:["parentNodeId: ",o==null?void 0:o.parent.id]}),e.jsxs("p",{children:["parentType: ",o==null?void 0:o.parent.type]}),e.jsxs("p",{children:["parentKey: ",o==null?void 0:o.key]}),e.jsxs("p",{children:["parentIndex: ",o==null?void 0:o.index]})]})})}function W({debug:t,children:d}){return e.jsx(C.Provider,{value:{debug:t},children:d})}function L({sourceFile:t,firstElementCreatorRef:d}){const{requestFocus:i}=h(),o=n.useRef(!1);return n.useEffect(()=>{var s;if(!o.current)if(t.code.length===0)console.log("Requesting initial focus on empty file creator"),(s=d.current)==null||s.focus(),o.current=!0;else{const l=t.code[0];console.log("Requesting initial focus on first node:",l.id),i({nodeId:l.id}),o.current=!0}},[t,i,d]),null}function z(){const[t,d]=n.useState(void 0),[i,o]=n.useState(null),[s,l]=n.useState(null),[f,u]=n.useState(null),[p,r]=n.useState(null),[x,b]=n.useState(!1);n.useEffect(()=>{const c=g=>{console.log("event:",g);const a=g.data;console.log("message:",a),a.type==="update"?d(a.contents):a.type==="availableInserts"?r(a.contents):a.type==="toggleDebug"&&(console.log("Toggling debug mode"),b(v=>!v))};return window.addEventListener("message",c),S.postMessage({type:"ready"}),()=>{window.removeEventListener("message",c)}},[]),n.useEffect(()=>{console.log("SelectedKey updated:",s)},[s]);const y=(c,g)=>{const a={type:"nodeEdit",contents:c,key:g};d(v=>v&&{...v}),console.log("sending message: ",a),S.postMessage(a)},j=(c,g)=>{const a={type:"requestAvailableInserts",nodeId:c,nodeKey:g};console.log("requesting available inserts: ",a),S.postMessage(a)},w=n.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(W,{debug:x,children:t?e.jsxs(E,{sourceFile:t,onEdit:y,onRequestAvailableInserts:j,availableInserts:p,selectedNodeId:i,selectedKey:s,parentNodeInfo:f,setSelectedNodeId:o,setSelectedKey:c=>{console.log("setSelectedKey called with key:",c),l(c)},setParentNodeInfo:u,children:[e.jsx(L,{sourceFile:t,firstElementCreatorRef:w}),e.jsx(R,{}),e.jsx(K,{position:"bottom-left"}),e.jsx(I,{node:t,firstElementCreatorRef:w}),e.jsx(D,{})]}):e.jsx("p",{children:"loading..."})})})}k.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(z,{})}));
