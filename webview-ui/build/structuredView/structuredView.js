import{u as b,b as o,j as e,E as a,v,L as I,S as M,c as D}from"../shared/vscode.js";function R(){const{mode:s,setMode:n}=b(),[r,t]=o.useState(!1),i=()=>{n(s===a.View?a.Edit:a.View)},c=g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),i())},p="mode-indicator-keybind",f=s===a.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:i,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),onFocus:()=>t(!0),onBlur:()=>t(!1),onKeyDown:c,role:"button","aria-describedby":r?p:void 0,style:{padding:"5px 10px",backgroundColor:s===a.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:s===a.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(s===a.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:r?`0 0 0 2px ${s===a.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:r?"translateY(-1px)":void 0,filter:r?"brightness(1.05)":void 0},children:["MODE: ",s.toUpperCase()]}),r&&e.jsx("div",{id:p,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:f})]})}const y=o.createContext(null);function k(){const s=o.useContext(y);if(!s)throw new Error("DebugContext must be used inside a provider");return s}function C(){var c;const{debug:s}=k(),{selectedNodeId:n,selectedKey:r,parentNodeInfo:t,nodeMap:i}=b();return e.jsx(e.Fragment,{children:s&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",n]}),e.jsxs("p",{children:["selectedNodeType: ",(c=i.get(n??""))==null?void 0:c.type]}),e.jsxs("p",{children:["selectedKey: ",r]}),e.jsxs("p",{children:["parentNodeId: ",t==null?void 0:t.parent.id]}),e.jsxs("p",{children:["parentType: ",t==null?void 0:t.parent.type]}),e.jsxs("p",{children:["parentKey: ",t==null?void 0:t.key]}),e.jsxs("p",{children:["parentIndex: ",t==null?void 0:t.index]})]})})}function K({debug:s,children:n}){return e.jsx(y.Provider,{value:{debug:s},children:n})}function W({sourceFile:s,firstElementCreatorRef:n}){const{requestFocus:r}=b(),t=o.useRef(!1);return o.useEffect(()=>{var i;if(!t.current)if(s.code.length===0)console.log("Requesting initial focus on empty file creator"),(i=n.current)==null||i.focus(),t.current=!0;else{const c=s.code[0];console.log("Requesting initial focus on first node:",c.id),r({nodeId:c.id}),t.current=!0}},[s,r,n]),null}function q(){const[s,n]=o.useState(void 0),[r,t]=o.useState(null),[i,c]=o.useState(null),[p,f]=o.useState(null),[g,j]=o.useState(null),[m,w]=o.useState(!1);o.useEffect(()=>{const l=u=>{console.log("event:",u);const d=u.data;console.log("message:",d),d.type==="update"?n(d.contents):d.type==="availableInserts"?j(d.contents):d.type==="toggleDebug"&&(console.log("Toggling debug mode"),w(x=>!x))};return window.addEventListener("message",l),v.postMessage({type:"ready"}),()=>{window.removeEventListener("message",l)}},[]),o.useEffect(()=>{console.log("SelectedKey updated:",i)},[i]);const S=(l,u)=>{const d={type:"nodeEdit",contents:l,key:u};n(x=>x&&{...x}),console.log("sending message: ",d),v.postMessage(d)},E=(l,u)=>{const d={type:"requestAvailableInserts",nodeId:l,nodeKey:u};console.log("requesting available inserts: ",d),v.postMessage(d)},h=o.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(K,{debug:m,children:s?e.jsxs(I,{sourceFile:s,onEdit:S,onRequestAvailableInserts:E,availableInserts:g,selectedNodeId:r,selectedKey:i,parentNodeInfo:p,setSelectedNodeId:t,setSelectedKey:l=>{console.log("setSelectedKey called with key:",l),c(l)},setParentNodeInfo:f,children:[e.jsx(W,{sourceFile:s,firstElementCreatorRef:h}),e.jsx(R,{}),e.jsx(M,{node:s,firstElementCreatorRef:h}),e.jsx(C,{})]}):e.jsx("p",{children:"loading..."})})})}D.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(q,{})}));
