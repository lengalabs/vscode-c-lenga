import{u as C,b as i,j as e,E as h,v as K,L,S as q,c as B}from"../shared/vscode.js";function D(){const{mode:r,setMode:c}=C(),[a,o]=i.useState(!1),n=()=>{c(r===h.View?h.Edit:h.View)},s=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),n())},v="mode-indicator-keybind",y=r===h.View?"Press the SpaceBar to switch to edit mode":"Press Esc or Spacebar to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:n,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),onKeyDown:s,role:"button","aria-describedby":a?v:void 0,style:{padding:"5px 10px",backgroundColor:r===h.View?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:r===h.View?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(r===h.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:a?`0 0 0 2px ${r===h.View?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:a?"translateY(-1px)":void 0,filter:a?"brightness(1.05)":void 0},children:["MODE: ",r.toUpperCase()]}),a&&e.jsx("div",{id:v,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:y})]})}function F(){const{mode:r,keyboardState:c}=C(),{pressedKeys:a,modifiers:o}=c,{shift:n,alt:s,ctrl:v}=o,[y,p]=i.useState(s),k=[{key:"J/←",equivalents:["arrowleft"],columns:{base:"Previous Field",shift:null,ctrl:"Navigate to Parent",ctrlShift:null,alt:"Move Node to Parent's Prev Sibling",altShift:"Move Node to Parent's Next Sibling"}},{key:"L/↑",equivalents:["arrowup"],columns:{base:"Previous Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Move Node Up",altShift:"Move Node Into Prev Sibling"}},{key:"K/↓",equivalents:["arrowdown"],columns:{base:"Next Sibling",shift:null,ctrl:null,ctrlShift:null,alt:"Move Node Down",altShift:"Move Node Into Next Sibling"}},{key:"Ñ/→",equivalents:["arrowright","n"],columns:{base:"Next Field",shift:null,ctrl:"Navigate to First Child",ctrlShift:"Navigate to Last Child",alt:"Move Node Into Next Sibling",altShift:"Move Node Into Prev Sibling"}},{key:"Enter",equivalents:[],columns:{base:"Insert Sibling After",shift:"Insert Sibling Before",ctrl:"Insert Child at Start",ctrlShift:"Insert Child at End",alt:null,altShift:null}},{key:"Del/Backspace",equivalents:["delete","backspace"],columns:{base:"Delete Node",shift:null,ctrl:null,ctrlShift:null,alt:null,altShift:null}}],[x,j]=i.useState("navigate"),I=[{key:"navigate",label:"Navigate"},{key:"move",label:"Move (Alt)"}],E={navigate:[{key:"base",label:"Base"},{key:"shift",label:"Shift"},{key:"ctrl",label:"Ctrl"},{key:"ctrlShift",label:"Ctrl+Shift"}],move:[{key:"alt",label:"Alt"},{key:"altShift",label:"Alt+Shift"}]};i.useEffect(()=>{if(s===y)return;p(s);const t=s?"move":"navigate";x!==t&&j(t)},[s,x,y,p]);const w=t=>{j(t)},g=E[x],b=t=>({border:t?"1px solid rgba(255, 140, 50, 0.4)":"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t?"var(--vscode-button-background)":"var(--vscode-input-background)",color:t?"var(--vscode-button-foreground)":"var(--vscode-input-foreground)",fontSize:"0.9rem",lineHeight:"1",transition:"all 0.03s ease",cursor:"default",transform:t?"translateY(0.15rem) scale(0.98)":"translateY(0)",boxShadow:t?"0 0.05rem 0.2rem rgba(255, 140, 50, 0.15), inset 0 0.15rem 0.25rem rgba(0, 0, 0, 0.2)":"0 0.2rem 0.4rem rgba(0, 0, 0, 0.1), inset 0 0.1rem 0 rgba(255, 255, 255, 0.15), inset 0 -0.1rem 0.15rem rgba(0, 0, 0, 0.1)"}),l=(t,u,m,d="2.8rem",S="2.8rem")=>{const W=[t,...m||[]].map(R=>R.toLowerCase()).some(R=>a.has(R));return e.jsxs("div",{style:{width:d,height:S,...b(W)},children:[e.jsx("div",{style:{fontSize:"0.6rem",opacity:.7},children:u}),e.jsx("div",{style:{fontWeight:"bold"},children:t.toUpperCase()})]},t)},f=(t,u,m="3.2rem")=>e.jsx("div",{style:{width:m,height:"2rem",...b(u)},children:t},t);if(r!=="view")return null;const N=s&&n&&!v?"altShift":s&&!n&&!v?"alt":v&&n&&!s?"ctrlShift":v&&!n&&!s?"ctrl":n&&!s&&!v?"shift":!s&&!n&&!v?"base":null,T=t=>{const u=t.key.toLowerCase().split("/").map(d=>d==="←"?"arrowleft":d==="↑"?"arrowup":d==="↓"?"arrowdown":d==="→"?"arrowright":d==="del"?"delete":d);return[...new Set([...u,...t.equivalents||[]].map(d=>d.toLowerCase()))].some(d=>a.has(d))},P=`3.8rem repeat(${g.length}, 1fr)`;return e.jsxs("div",{style:{position:"fixed",bottom:"1rem",left:"1rem",zIndex:999,display:"flex",gap:"1rem",alignItems:"flex-end"},children:[e.jsxs("div",{style:{padding:"0.8rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",fontSize:"1rem",fontFamily:"monospace",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.3rem",marginBottom:"0.4rem"},children:[l("j","←",["arrowleft"]),l("k","↓",["arrowdown"]),l("l","↑",["arrowup"]),l("ñ","→",["arrowright","n"])]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem",justifyContent:"space-between"},children:[f("CTRL",v),f("ALT",s),f("SHIFT",n,"3.6rem")]})]}),e.jsxs("div",{style:{padding:"0.6rem",backgroundColor:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"0.4rem",boxShadow:"0 0.2rem 0.8rem rgba(0, 0, 0, 0.15)",fontSize:"0.75rem",fontFamily:"monospace"},children:[e.jsx("div",{style:{display:"flex",gap:"0.4rem",marginBottom:"0.5rem"},children:I.map(t=>{const u=x===t.key;return e.jsx("button",{type:"button",onClick:()=>w(t.key),style:{border:"1px solid var(--vscode-input-border)",borderRadius:"0.3rem",padding:"0.25rem 0.6rem",backgroundColor:u?"var(--vscode-button-background)":"var(--vscode-editorWidget-background)",color:u?"var(--vscode-button-foreground)":"var(--vscode-editorWidget-foreground)",cursor:"pointer",transition:"all 0.1s ease",fontSize:"0.75rem",fontFamily:"monospace"},children:t.label},t.key)})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:P,gap:"0.5rem",paddingBottom:"0.4rem",borderBottom:"1px solid var(--vscode-editorWidget-border)",marginBottom:"0.4rem"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:.8},children:"Key"}),g.map(t=>{const u=N===t.key;return e.jsx("div",{style:{fontWeight:"bold",opacity:u?1:.5,color:u?"var(--vscode-textLink-foreground)":"var(--vscode-editorWidget-foreground)"},children:t.label},t.key)})]}),k.map((t,u)=>{const m=T(t);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:P,gap:"0.5rem",padding:"0.3rem",margin:"0 -0.3rem",paddingLeft:"0.3rem",paddingRight:"0.3rem",borderBottom:u<k.length-1?"1px solid var(--vscode-editorWidget-border)":"none",backgroundColor:m?"rgba(255, 140, 50, 0.1)":"transparent",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:[e.jsx("div",{style:{fontWeight:"bold",opacity:m?1:.9,color:m?"rgba(255, 140, 50, 1)":"var(--vscode-editorWidget-foreground)",transition:"all 0.03s ease"},children:t.key}),g.map(d=>{const S=N===d.key,M=t.columns[d.key]||"—",W=m&&S&&M!=="—";return e.jsx("div",{style:{opacity:S?.9:.4,color:S?"var(--vscode-editorWidget-foreground)":"var(--vscode-descriptionForeground)",backgroundColor:W?"rgba(255, 140, 50, 0.2)":"transparent",padding:"0.2rem 0.3rem",margin:"-0.2rem -0.3rem",borderRadius:"0.2rem",transition:"all 0.03s ease"},children:M},d.key)})]},u)})]})]})}const A=i.createContext(null);function z(){const r=i.useContext(A);if(!r)throw new Error("DebugContext must be used inside a provider");return r}function V(){var s;const{debug:r}=z(),{selectedNodeId:c,selectedKey:a,parentNodeInfo:o,nodeMap:n}=C();return e.jsx(e.Fragment,{children:r&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",c]}),e.jsxs("p",{children:["selectedNodeType: ",(s=n.get(c??""))==null?void 0:s.type]}),e.jsxs("p",{children:["selectedKey: ",a]}),e.jsxs("p",{children:["parentNodeId: ",o==null?void 0:o.parent.id]}),e.jsxs("p",{children:["parentType: ",o==null?void 0:o.parent.type]}),e.jsxs("p",{children:["parentKey: ",o==null?void 0:o.key]}),e.jsxs("p",{children:["parentIndex: ",o==null?void 0:o.index]})]})})}function H({debug:r,children:c}){return e.jsx(A.Provider,{value:{debug:r},children:c})}function U({sourceFile:r,firstElementCreatorRef:c}){const{requestFocus:a}=C(),o=i.useRef(!1);return i.useEffect(()=>{var n;if(!o.current)if(r.code.length===0)console.log("Requesting initial focus on empty file creator"),(n=c.current)==null||n.focus(),o.current=!0;else{const s=r.code[0];console.log("Requesting initial focus on first node:",s.id),a({nodeId:s.id}),o.current=!0}},[r,a,c]),null}function Y(){const[r,c]=i.useState(void 0),[a,o]=i.useState(null),[n,s]=i.useState(null),[v,y]=i.useState(null),[p,k]=i.useState(null),[x,j]=i.useState(!1);i.useEffect(()=>{const g=b=>{console.log("event:",b);const l=b.data;console.log("message:",l),l.type==="update"?c(l.contents):l.type==="availableInserts"?k(l.contents):l.type==="toggleDebug"&&(console.log("Toggling debug mode"),j(f=>!f))};return window.addEventListener("message",g),K.postMessage({type:"ready"}),()=>{window.removeEventListener("message",g)}},[]),i.useEffect(()=>{console.log("SelectedKey updated:",n)},[n]);const I=(g,b)=>{const l={type:"nodeEdit",contents:g,key:b};c(f=>f&&{...f}),console.log("sending message: ",l),K.postMessage(l)},E=(g,b)=>{const l={type:"requestAvailableInserts",nodeId:g,nodeKey:b};console.log("requesting available inserts: ",l),K.postMessage(l)},w=i.useRef(null);return e.jsx("div",{style:{height:"100%"},children:e.jsx(H,{debug:x,children:r?e.jsxs(L,{sourceFile:r,onEdit:I,onRequestAvailableInserts:E,availableInserts:p,selectedNodeId:a,selectedKey:n,parentNodeInfo:v,setSelectedNodeId:o,setSelectedKey:g=>{console.log("setSelectedKey called with key:",g),s(g)},setParentNodeInfo:y,children:[e.jsx(U,{sourceFile:r,firstElementCreatorRef:w}),e.jsx(D,{}),e.jsx(F,{}),e.jsx(q,{node:r,firstElementCreatorRef:w}),e.jsx(V,{})]}):e.jsx("p",{children:"loading..."})})})}B.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Y,{})}));
